= Going _further_ with _CDI_ 1.2
Antoine Sabot-Durand; Antonin Stefanutti
:description: Going farther with CDI 1.2
:website: http://astefanutti.github.io/javaone2014
:copyright: CC BY-SA 4.0
:backend: dzslides
:sectids!:
:experimental:
:toc2:
:sectanchors:
:idprefix:
:idseparator: -
:icons: font
:source-highlighter: highlightjs
:source-language: java
:language: no-highlight
:macros-on: subs="macros"
:caption-off: caption=""
:title-off: title="", caption=""
:dzslides-aspect: 16-9
:imagesdir: images
:next-label: pass:quotes,attributes[*Next* [icon:caret-right[]]
:dzslides-style: asciidoctor
:dzslides-highlight: github
:dzslides-transition: fade
:dzslides-fonts: family=Neuton:400,700,800,400italic|Cedarville+Cursive
:hide-uri-scheme:

[.topic.source]
== Antoine Sabot-Durand

====
* icon:user[] Senior Software Engineer
* icon:user[] CDI co-spec lead
* icon:institution[] Red Hat, Inc.
* icon:twitter[] @antoine_sd
* icon:rss[] www.next-presso.com
* icon:github[] github.com/antoinesd
====


[.topic.source]
== Antonin Stefanutti

====
* icon:user[] Software Engineer
* icon:institution[] Murex, SAS
* icon:twitter[] @astefanut
* icon:github[] github.com/astefanutti
====


[.topic.source]
== Should I stay or should I go ?

====
* icon:cogs[] A talk about CDI *advanced*
====

====
* icon:reply[] Might be hard for beginners
====

====
* icon:share[] Don't need to be a CDI guru
====

[.topic.source]
== Should I stay or should I go ?

TIP: If you know the most of these you can stay

[.split]
* `@Inject`
* `@Produces`
* `Event<T>`
* `@Observes`
* `@Qualifier`
* `InjectionPoint`


[.topic.source]
== Agenda

[.recap]
====
* icon:info-circle[] CDI Extensions
* icon:info-circle[] Legacy Code
* icon:info-circle[] Camel CDI
* icon:info-circle[] Metrics CDI
====


[.intro]
== Introducing CDI portable extensions

[.topic.source]
== CDI portable extensions

====
* Extending CDI and Java EE
====

====
* Change CDI meta data
====

====
* Linked to BeanManager Lifecycle
====



[.topic.source]
== Portable Extensions

One of the _most powerful feature_ of the CDI specification

Not really popularized partly due to the _high level of abstraction_

image::powerful.gif[role="pull-right", width="300"]


[.topic.source]
== Container Metadata

Observer pattern to listen for container _initialization lifecycle events_

Comprehensive access to and modification of the _container metadata model_

image::rubik.gif[role="pull-right", width="250"]


[.topic.source]
== Plugin Architecture

NOTE: Service provider of the service `javax.enterprise.inject.spi.Extension` declared in `META-INF/services`

[source, subs="verbatim,quotes"]
----
import javax.enterprise.event.Observes;
import javax.enterprise.inject.spi.Extension;

class CdiExtension [highlight]#implements Extension# {

    void beforeBeanDiscovery([highlight]#@Observes BeforeBeanDiscovery# bbd) {
    }
    ...

    void afterDeploymentValidation([highlight]#@Observes AfterDeploymentValidation# adv) {
    }
}
----

[.topic.source]
== Bean Manager Lifecycle

image::simple-lifecycle.svg[height="95%",width="95%"]


include::partial/complete_lifecycle.part[]

[.topic.source]
== Example: Ignoring JPA Entities

TIP: The following extension prevents CDI to manage entities

NOTE: This is a commonly admitted good practice

[source]
----
public class VetoEntity implements Extension {
    public void vetoEntity(@Observes @WithAnnotations({ Entity.class })
                           ProcessAnnotatedType<?> pat) {
        pat.veto();
    }
}
----

[.topic.source]
== Remember

WARNING: Extensions are launched during bootstrap and are based on CDI events

WARNING: Once application is bootstrapped, the Bean Manager is in read-only mode (no runtime bean registration)

WARNING: You only have to `@Observes` built-in CDI event to create your extensions


include::partial/legacy.part[]

//include::partial/camel.part[]

include::partial/metrics.part[]


[.topic.source]
== References

NOTE: Slides generated with _Asciidoctor_, _PlantUML_ and _DZSlides_ backend

NOTE: Original slide template - _Dan Allen_ & _Sarah White_

NOTE: Camel CDI Extension - https://github.com/astefanutti/camel-cdi

NOTE: Metrics CDI Extension - https://github.com/astefanutti/metrics-cdi


[.topic.ending, hrole="name"]
== Antoine Sabot-Durand Antonin Stefanutti

[.footer]
icon:twitter[] @antoine_sd @astefanut
